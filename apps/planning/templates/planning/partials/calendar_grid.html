{% load planning_tags %}
<!-- Calendar Grid -->
<div class="bg-white rounded-lg shadow">
    <!-- Desktop view -->
    <div class="hidden md:block">
        <!-- Header row with days -->
        <div class="grid grid-cols-7 border-b border-gray-200">
            {% for day in days %}
            <div class="px-2 py-3 text-center {% if day.is_today %}bg-blue-50{% endif %}">
                <div class="text-xs font-medium text-gray-500 uppercase">
                    {{ day.date|date:"D" }}
                </div>
                <div class="mt-1 text-lg font-semibold {% if day.is_today %}text-blue-600{% else %}text-gray-900{% endif %}">
                    {{ day.date|date:"j" }}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Meal rows -->
        {% for meal_type_value, meal_type_label in meal_types.choices %}
        <div class="grid grid-cols-7 border-b border-gray-200 last:border-b-0">
            {% for day in days %}
            <div class="border-r border-gray-100 last:border-r-0 min-h-24 {% if day.is_today %}bg-blue-50/30{% endif %}"
                 id="slot-{{ day.date|date:'Y-m-d' }}-{{ meal_type_value }}"
                 @dragover="handleDragOver($event)"
                 @dragenter="handleDragEnter($event)"
                 @dragleave="handleDragLeave($event)"
                 @drop="handleDrop($event, '{{ day.date|date:'Y-m-d' }}', '{{ meal_type_value }}')">
                {% with meals=day.meals|get_item:meal_type_value %}
                {% include "planning/partials/meal_slot.html" with meals=meals date=day.date meal_type=meal_type_value %}
                {% endwith %}
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <!-- Mobile view -->
    <div class="md:hidden">
        {% for day in days %}
        <div class="border-b border-gray-200 last:border-b-0 {% if day.is_today %}bg-blue-50/30{% endif %}">
            <div class="px-4 py-2 bg-gray-50 {% if day.is_today %}bg-blue-100{% endif %}">
                <span class="font-medium {% if day.is_today %}text-blue-700{% else %}text-gray-900{% endif %}">
                    {{ day.date|date:"l, F j" }}
                </span>
            </div>
            <div class="divide-y divide-gray-100">
                {% for meal_type_value, meal_type_label in meal_types.choices %}
                <div class="px-4 py-3"
                     id="mobile-slot-{{ day.date|date:'Y-m-d' }}-{{ meal_type_value }}">
                    <div class="text-xs font-medium text-gray-500 uppercase mb-2">{{ meal_type_label }}</div>
                    {% with meals=day.meals|get_item:meal_type_value %}
                    {% include "planning/partials/meal_slot.html" with meals=meals date=day.date meal_type=meal_type_value mobile=True %}
                    {% endwith %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Meal type labels (desktop only) -->
<div class="hidden md:block mt-4">
    <div class="flex justify-center gap-6 text-sm text-gray-500">
        {% for meal_type_value, meal_type_label in meal_types.choices %}
        <span class="flex items-center">
            <span class="w-3 h-3 rounded-full mr-2
                {% if meal_type_value == 'breakfast' %}bg-yellow-400
                {% elif meal_type_value == 'lunch' %}bg-green-400
                {% else %}bg-blue-400{% endif %}">
            </span>
            {{ meal_type_label }}
        </span>
        {% endfor %}
    </div>
</div>

{% if is_htmx %}
<!-- OOB swaps for navigation and week range (HTMX only) -->
<nav id="calendar-nav" class="flex items-center" hx-swap-oob="true" aria-label="Calendar navigation">
    {% include "planning/partials/calendar_nav.html" %}
</nav>

<div id="week-range" class="text-center" hx-swap-oob="true">
    <h2 class="text-lg font-medium text-gray-700">
        {{ start_of_week|date:"F j" }} - {{ end_of_week|date:"F j, Y" }}
    </h2>
</div>
{% endif %}

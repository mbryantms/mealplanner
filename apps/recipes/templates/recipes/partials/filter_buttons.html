<!-- Cuisine Filter -->
{% if form.cuisines.field.queryset.exists %}
<div class="relative" x-data="{ open: false }">
    <button type="button" @click="open = !open"
            class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border
                   {% if cuisine_count %}bg-amber-100 text-amber-800 border-amber-300{% else %}bg-gray-50 text-gray-700 border-gray-300 hover:bg-gray-100{% endif %}">
        <span>Cuisine</span>
        {% if cuisine_count %}
        <span class="ml-1.5 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-amber-600 rounded-full">
            {{ cuisine_count }}
        </span>
        {% endif %}
        <svg class="w-4 h-4 ml-1.5 transition-transform" :class="{ 'rotate-180': open }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>
    <div x-show="open" @click.away="open = false" x-cloak
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute z-10 mt-1 w-64 bg-white rounded-md shadow-lg border border-gray-200 p-3">
        <div class="flex flex-wrap gap-2">
            {% for checkbox in form.cuisines %}
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" name="cuisines" value="{{ checkbox.data.value }}"
                       {% if checkbox.data.selected %}checked{% endif %}
                       class="sr-only peer"
                       hx-get="{% url 'recipes:recipe_list' %}"
                       hx-trigger="change"
                       hx-target="#recipe-list"
                       hx-push-url="true"
                       hx-include="[name='q'], [name='cuisines'], [name='proteins'], [name='dish_types'], [name='tags']">
                <span class="px-2.5 py-1 text-sm font-medium rounded-full transition-colors
                             peer-checked:bg-amber-600 peer-checked:text-white
                             bg-gray-100 text-gray-700 hover:bg-gray-200">
                    {{ checkbox.choice_label }}
                </span>
            </label>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Protein Filter -->
{% if form.proteins.field.queryset.exists %}
<div class="relative" x-data="{ open: false }">
    <button type="button" @click="open = !open"
            class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border
                   {% if protein_count %}bg-rose-100 text-rose-800 border-rose-300{% else %}bg-gray-50 text-gray-700 border-gray-300 hover:bg-gray-100{% endif %}">
        <span>Protein</span>
        {% if protein_count %}
        <span class="ml-1.5 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-rose-600 rounded-full">
            {{ protein_count }}
        </span>
        {% endif %}
        <svg class="w-4 h-4 ml-1.5 transition-transform" :class="{ 'rotate-180': open }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>
    <div x-show="open" @click.away="open = false" x-cloak
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute z-10 mt-1 w-64 bg-white rounded-md shadow-lg border border-gray-200 p-3">
        <div class="flex flex-wrap gap-2">
            {% for checkbox in form.proteins %}
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" name="proteins" value="{{ checkbox.data.value }}"
                       {% if checkbox.data.selected %}checked{% endif %}
                       class="sr-only peer"
                       hx-get="{% url 'recipes:recipe_list' %}"
                       hx-trigger="change"
                       hx-target="#recipe-list"
                       hx-push-url="true"
                       hx-include="[name='q'], [name='cuisines'], [name='proteins'], [name='dish_types'], [name='tags']">
                <span class="px-2.5 py-1 text-sm font-medium rounded-full transition-colors
                             peer-checked:bg-rose-600 peer-checked:text-white
                             bg-gray-100 text-gray-700 hover:bg-gray-200">
                    {{ checkbox.choice_label }}
                </span>
            </label>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Dish Type Filter -->
{% if form.dish_types.field.queryset.exists %}
<div class="relative" x-data="{ open: false }">
    <button type="button" @click="open = !open"
            class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border
                   {% if dish_type_count %}bg-indigo-100 text-indigo-800 border-indigo-300{% else %}bg-gray-50 text-gray-700 border-gray-300 hover:bg-gray-100{% endif %}">
        <span>Dish Type</span>
        {% if dish_type_count %}
        <span class="ml-1.5 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-indigo-600 rounded-full">
            {{ dish_type_count }}
        </span>
        {% endif %}
        <svg class="w-4 h-4 ml-1.5 transition-transform" :class="{ 'rotate-180': open }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>
    <div x-show="open" @click.away="open = false" x-cloak
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute z-10 mt-1 w-64 bg-white rounded-md shadow-lg border border-gray-200 p-3">
        <div class="flex flex-wrap gap-2">
            {% for checkbox in form.dish_types %}
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" name="dish_types" value="{{ checkbox.data.value }}"
                       {% if checkbox.data.selected %}checked{% endif %}
                       class="sr-only peer"
                       hx-get="{% url 'recipes:recipe_list' %}"
                       hx-trigger="change"
                       hx-target="#recipe-list"
                       hx-push-url="true"
                       hx-include="[name='q'], [name='cuisines'], [name='proteins'], [name='dish_types'], [name='tags']">
                <span class="px-2.5 py-1 text-sm font-medium rounded-full transition-colors
                             peer-checked:bg-indigo-600 peer-checked:text-white
                             bg-gray-100 text-gray-700 hover:bg-gray-200">
                    {{ checkbox.choice_label }}
                </span>
            </label>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Tags Filter -->
{% if form.tags.field.queryset.exists %}
<div class="relative" x-data="{ open: false }">
    <button type="button" @click="open = !open"
            class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border
                   {% if tag_count %}bg-blue-100 text-blue-800 border-blue-300{% else %}bg-gray-50 text-gray-700 border-gray-300 hover:bg-gray-100{% endif %}">
        <span>Tags</span>
        {% if tag_count %}
        <span class="ml-1.5 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full">
            {{ tag_count }}
        </span>
        {% endif %}
        <svg class="w-4 h-4 ml-1.5 transition-transform" :class="{ 'rotate-180': open }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>
    <div x-show="open" @click.away="open = false" x-cloak
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute z-10 mt-1 w-80 bg-white rounded-md shadow-lg border border-gray-200 p-3">
        <div class="flex flex-wrap gap-2">
            {% for checkbox in form.tags %}
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" name="tags" value="{{ checkbox.data.value }}"
                       {% if checkbox.data.selected %}checked{% endif %}
                       class="sr-only peer"
                       hx-get="{% url 'recipes:recipe_list' %}"
                       hx-trigger="change"
                       hx-target="#recipe-list"
                       hx-push-url="true"
                       hx-include="[name='q'], [name='cuisines'], [name='proteins'], [name='dish_types'], [name='tags']">
                <span class="px-2.5 py-1 text-sm font-medium rounded-full transition-colors
                             peer-checked:bg-blue-600 peer-checked:text-white
                             bg-gray-100 text-gray-700 hover:bg-gray-200">
                    {{ checkbox.choice_label }}
                </span>
            </label>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Clear Filters -->
{% if has_filters %}
<button type="button"
        hx-get="{% url 'recipes:recipe_list' %}{% if search_query %}?q={{ search_query }}{% endif %}"
        hx-target="#recipe-list"
        hx-push-url="true"
        class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-500 hover:text-gray-700">
    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
    Clear filters
</button>
{% endif %}

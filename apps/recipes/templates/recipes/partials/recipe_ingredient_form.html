<form hx-post="{% url 'recipes:recipe_ingredient_add' recipe.pk %}"
      hx-target="#ingredients-container"
      hx-swap="beforeend"
      hx-on::after-request="if(event.detail.successful) this.reset()"
      class="bg-gray-50 p-4 rounded-md">
    {% csrf_token %}

    <div class="grid grid-cols-1 sm:grid-cols-6 gap-3">
        <!-- Ingredient Search/Select -->
        <div class="sm:col-span-2" x-data="{ search: '', showDropdown: false, ingredients: [] }">
            <label class="block text-xs font-medium text-gray-600 mb-1">Ingredient</label>
            <div class="relative">
                <input type="text"
                       x-model="search"
                       @input.debounce.300ms="if(search.length >= 2) { fetch('{% url 'recipes:ingredient_autocomplete' %}?q=' + search).then(r => r.text()).then(html => { $refs.dropdown.innerHTML = html; showDropdown = true; }) }"
                       @focus="if(ingredients.length) showDropdown = true"
                       @click.outside="showDropdown = false"
                       placeholder="Search ingredients..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                <div x-ref="dropdown" x-show="showDropdown" x-cloak
                     class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto">
                </div>
            </div>
            <input type="hidden" name="ingredient" id="ingredient-id">
        </div>

        <!-- Quantity -->
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Qty</label>
            <input type="number" name="quantity" step="0.001" min="0"
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
        </div>

        <!-- Unit -->
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Unit</label>
            <input type="text" name="unit" placeholder="oz, cups..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
        </div>

        <!-- Preparation -->
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Prep</label>
            <input type="text" name="preparation" placeholder="diced..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
        </div>

        <!-- Optional + Submit -->
        <div class="flex items-end gap-2">
            <label class="flex items-center text-sm text-gray-600">
                <input type="checkbox" name="optional" class="mr-1 h-4 w-4 rounded">
                Optional
            </label>
            <button type="submit"
                    class="px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                Add
            </button>
        </div>
    </div>
</form>

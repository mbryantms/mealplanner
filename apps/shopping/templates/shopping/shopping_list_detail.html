{% extends "base.html" %}

{% block title %}{{ shopping_list.name }} - Family Meal Planner{% endblock %}

{% block content %}
{% csrf_token %}
<div class="space-y-6" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <nav class="flex mb-2" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2 text-sm text-gray-500">
                    <li><a href="{% url 'shopping:list' %}" class="hover:text-gray-700">Shopping Lists</a></li>
                    <li><span class="mx-2">/</span></li>
                    <li class="text-gray-900">{{ shopping_list.name }}</li>
                </ol>
            </nav>
            <h1 class="text-2xl font-bold text-gray-900">{{ shopping_list.name }}</h1>
            {% if shopping_list.date_range %}
            <p class="text-sm text-gray-500 mt-1">{{ shopping_list.date_range }}</p>
            {% endif %}
        </div>
        <div class="flex gap-2">
            <a href="{% url 'shopping:edit' shopping_list.pk %}"
               class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Edit
            </a>
            <a href="{% url 'shopping:delete' shopping_list.pk %}"
               class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-700 bg-white border border-red-300 rounded-md hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
                Delete
            </a>
        </div>
    </div>

    <!-- Progress bar -->
    <div id="progress-section">
    {% if shopping_list.total_count > 0 %}
        <div class="bg-white rounded-lg shadow p-4">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700">Progress</span>
                <span class="text-sm text-gray-500">{{ shopping_list.checked_count }} of {{ shopping_list.total_count }} items</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div class="bg-green-500 h-3 rounded-full transition-all duration-500 ease-out"
                     x-data="{ width: window.progressWidth ?? 0 }"
                     x-init="$nextTick(() => { width = {{ shopping_list.progress_percent }}; window.progressWidth = width; })"
                     :style="'width: ' + width + '%'"></div>
            </div>
            {% if shopping_list.checked_count > 0 %}
            <div class="mt-3 flex gap-2 text-sm">
                <form method="post" action="{% url 'shopping:clear_checked' shopping_list.pk %}"
                      hx-post="{% url 'shopping:clear_checked' shopping_list.pk %}"
                      hx-target="#items-container"
                      hx-swap="innerHTML">
                    {% csrf_token %}
                    <button type="submit" class="text-red-600 hover:text-red-800 hover:underline">
                        Clear checked
                    </button>
                </form>
                <span class="text-gray-300">|</span>
                <form method="post" action="{% url 'shopping:uncheck_all' shopping_list.pk %}"
                      hx-post="{% url 'shopping:uncheck_all' shopping_list.pk %}"
                      hx-target="#items-container"
                      hx-swap="innerHTML">
                    {% csrf_token %}
                    <button type="submit" class="text-gray-600 hover:text-gray-800 hover:underline">
                        Uncheck all
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
    {% endif %}
    </div>

    <!-- Quick Add Form -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <form method="post"
              action="{% url 'shopping:item_add' shopping_list.pk %}"
              hx-post="{% url 'shopping:item_add' shopping_list.pk %}"
              hx-target="#items-container"
              hx-swap="beforeend"
              hx-on::after-request="if(event.detail.successful) this.reset()"
              class="flex flex-col sm:flex-row gap-2">
            {% csrf_token %}
            <input type="text" name="item_name" required
                   placeholder="Add item..."
                   class="flex-grow px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <div class="flex gap-2">
                <input type="number" name="quantity" step="0.01" min="0" placeholder="Qty"
                       class="w-20 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <input type="text" name="unit" placeholder="unit"
                       class="w-20 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <button type="submit"
                        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Add
                </button>
            </div>
        </form>
    </div>

    <!-- Sort Toggle -->
    <div class="flex items-center justify-end gap-2">
        <span class="text-sm text-gray-500">Sort by:</span>
        <div class="inline-flex rounded-md shadow-sm" role="group">
            <a href="?sort=category"
               class="px-3 py-1.5 text-sm font-medium rounded-l-md border
                      {% if sort_by == 'category' %}bg-blue-600 text-white border-blue-600{% else %}bg-white text-gray-700 border-gray-300 hover:bg-gray-50{% endif %}">
                Aisle
            </a>
            <a href="?sort=alphabetical"
               class="px-3 py-1.5 text-sm font-medium rounded-r-md border-t border-b border-r
                      {% if sort_by == 'alphabetical' %}bg-blue-600 text-white border-blue-600{% else %}bg-white text-gray-700 border-gray-300 hover:bg-gray-50{% endif %}">
                A-Z
            </a>
        </div>
    </div>

    <!-- Items List -->
    <div id="items-container" class="space-y-4">
        {% include "shopping/partials/items_list.html" %}
    </div>
</div>
{% endblock %}
